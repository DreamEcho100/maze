# Form Manager Resolver for Zod

A sophisticated schema-to-form resolution engine that transforms Zod schemas into a structured trie-based representation for advanced form field management. This library serves as the foundation for validator-agnostic form state management.

## Overview

This resolver extracts field configurations, validation rules, and metadata from Zod schemas, creating a **Trie data structure** that enables:

- **Schema-driven form management** - All fields and their properties are derived from the schema
- **Token-based path system** - Efficient handling of arrays, records, and unions through symbolic tokens
- **Rich metadata extraction** - Native HTML attributes, constraints, and validation rules
- **Advanced type composition** - Full support for unions, intersections, and discriminated unions
- **Lazy evaluation** - Performance-optimized field resolution for large schemas
- **Validator-agnostic foundation** - Common interface for future schema validator integrations

## Core Concepts

### Trie-Based Field Structure/Shape

Instead of flat field maps like other form libraries, this resolver creates a **hierarchical trie** where each node represents a form field with complete metadata:

```typescript
const userSchema = z.object({
  name: z.string().min(1),
  addresses: z.array(z.object({
    street: z.string(),
    city: z.string()
  }))
});

const resolver = zodResolver(userSchema);
// Access field configurations through dot notation:
resolver.pathToNode["name"]           // String field config
resolver.pathToNode["addresses"]      // Array field config  
resolver.pathToNode["addresses.@@__FN_TKN_ARR_ITEM__@@.street"] // Array item street config
```

### Token-Based Path System

Complex structures use **symbolic tokens** to represent dynamic paths:

- **`@@__FN_TKN_ARR_ITEM__@@`** - Represents any array item
- **`@@__FN_TKN_RCRD_PROP__@@`** - Represents any record property  
- **`@@__FN_TKN_UNION_OPT_ON__@@`** - Represents union option branches

This enables efficient operations on collections without knowing specific indices or keys at compile time.

### Field Configuration Structure/Shape

Each field node contains comprehensive metadata:

```typescript
interface FormFieldOption {
  level: "primitive" | "object" | "array" | "tuple" | "record" | "union-root";
  pathString: string;
  pathSegments: PathSegmentItem[];
  default?: any;
  constraints: ValidationConstraints;  // min, max, pattern, required, etc.
  validation: ValidationFunction;
  metadata: FieldMetadata;            // lazy evaluation flags, type info
  userMetadata: UserDefinedMetadata;  // extensible user data
}
```

## Current Features

### âœ… **Complete Zod Type Coverage**

**Primitive Types:**
- String (with regex, length constraints)
- Number/BigInt (with range, multiple constraints) 
- Date (with range constraints)
- Boolean, File
- Literals, Enums

**Complex Types:**
- Objects (with lazy property evaluation)
- Arrays (with token-based item handling)
- Tuples (with lazy item evaluation)
- Records (with token-based property templates)
- Unions (with sophisticated option handling)
- Discriminated Unions (with tag mapping and nested discriminators)
- Intersections (with intelligent conflict resolution)

**Schema Modifiers:**
- Optional, Nullable, Default, Readonly
- Lazy schemas (recursive support)
- Pipes (input/output transformation chains)

### âœ… **Advanced Features**

- **Lazy Evaluation**: Object properties and tuple items are lazily computed for performance
- **Metadata Inheritance**: Complex inheritance system for union descendants and intersection items
- **Conflict Resolution**: Intelligent handling of incompatible intersection types (marked as `never`)
- **HTML Attribute Extraction**: Complete mapping to native form attributes (`min`, `max`, `pattern`, etc.)
- **Caching System**: WeakMap-based schema caching for performance
- **TypeScript Integration**: Full type safety and autocomplete support

### âœ… **Token System Benefits**

Unlike string-based path systems in other libraries:
- **Efficient array operations**: Single token represents all array items
- **Predictable record handling**: Template-based property validation
- **Union branch tracking**: Clear option identification and switching
- **Type-safe path access**: Full TypeScript inference and validation

## Roadmap

### ðŸ”¥ **Phase 1: Core Form Utilities** (High Priority)

**Field Array Management:**
- `append`, `prepend`, `insert`, `remove`, `move`, `swap` operations
- Automatic path reindexing and cleanup
- Array-specific validation and metadata handling

**Record Field Management:**
- `addProperty`, `removeProperty`, `renameProperty` operations  
- Dynamic property validation
- Key-type validation for typed records

**Union Field Management:**
- `switchToOption`, `getActiveOption`, `resolveDiscriminatedUnion`
- Automatic union branch detection and switching
- Cross-option validation and state management

### ðŸš€ **Phase 2: Form State Integration** (Medium Priority)

**Core Form State:**
- `values`: Form field current values management
- `errors`: Validation error collection and mapping
- `interaction`: Touch, focus, dirty, visited state tracking
- `submission`: Form submission state and retry logic

**State Utilities:**
- Path normalization (`normalizeZodPath`) for error mapping
- Field state queries (`getDirtyFields`, `getTouchedFields`)
- Batch operations (`validatePaths`, `setBulkValues`)
- Form snapshots and state diffing

**Performance Features:**
- Granular change subscriptions  
- Debounced validation
- Field isolation and render prevention
- Virtualization for large arrays

### âš¡ **Phase 3: Advanced Capabilities** (Lower Priority)

**Conditional Logic:**
- Field visibility rules (`showWhen`, `hideWhen`)
- Conditional validation (`skipWhen`, `onlyWhen`) 
- Dynamic field requirements and states
- Multi-step form wizards

**Validation Enhancements:**
- Custom validation composition
- Warning-level validation (non-blocking)
- Cross-field validation dependencies
- Async validation orchestration with proper cancellation

**Developer Experience:**
- Schema evolution and migration utilities
- Development-time debugging tools
- Integration adapters for popular state managers (Zustand, Valtio, Solid.js stores)
- Framework-specific bindings and components

### ðŸ”® **Phase 4: Ecosystem Expansion** (Future)

**Multi-Validator Support:**
- Yup resolver implementation
- Valibot resolver implementation  
- JSON Schema resolver implementation
- Custom validator adapter framework

**Advanced Integrations:**
- Server-side validation synchronization
- Real-time collaborative form editing
- Form analytics and usage tracking
- A11y enhancements and WCAG compliance tools

## Architecture Benefits

### vs React Hook Form
- **Structural fidelity**: Preserves schema relationships vs flattened field maps
- **Advanced type composition**: Native union/intersection support vs basic validation only
- **Token-based efficiency**: Optimized array/record operations vs string path manipulation

### vs Formik  
- **Schema-first design**: Built around schemas vs values-first with bolted validation
- **Rich constraint extraction**: Automatic HTML attribute generation vs manual setup
- **Type safety**: Full TypeScript inference vs loose typing

### vs Final Form
- **Integrated schema understanding**: Deep schema semantics vs schema-agnostic approach  
- **Path intelligence**: Structured path handling vs string-based field management
- **Metadata richness**: Comprehensive field information vs basic validation rules

## Integration Philosophy

This library focuses on **form field logic management** and is designed to integrate with your choice of:

- **State Management**: Zustand, Valtio, Solid.js stores, etc.
- **UI Frameworks**: React, Vue, Solid, Svelte, etc.  
- **Validation Libraries**: Zod (current), Yup, Valibot (future)

The headless approach ensures maximum flexibility while providing the sophisticated form handling capabilities that existing libraries lack.

---

*This resolver represents a new paradigm in form management - moving beyond simple field validation to comprehensive schema-driven form intelligence.*

```js
/*
TODO: Field Arrays Utils
- `append`
- `prepend`
- `insert`
- `remove`
- `move`
- `swap`
- `update`
- `replace`
*/
/*
TODO: Field Records Utils
addProperty
removeProperty
renameProperty
updateProperty
*/

```
